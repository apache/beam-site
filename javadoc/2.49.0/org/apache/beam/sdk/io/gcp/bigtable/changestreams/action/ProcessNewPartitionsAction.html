<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>ProcessNewPartitionsAction (Apache Beam 2.49.0)</title>
<link rel="stylesheet" type="text/css" href="../../../../../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="ProcessNewPartitionsAction (Apache Beam 2.49.0)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../../../../org/apache/beam/sdk/io/gcp/bigtable/changestreams/action/GenerateInitialPartitionsAction.html" title="class in org.apache.beam.sdk.io.gcp.bigtable.changestreams.action"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../../../../org/apache/beam/sdk/io/gcp/bigtable/changestreams/action/ReadChangeStreamPartitionAction.html" title="class in org.apache.beam.sdk.io.gcp.bigtable.changestreams.action"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../../../index.html?org/apache/beam/sdk/io/gcp/bigtable/changestreams/action/ProcessNewPartitionsAction.html" target="_top">Frames</a></li>
<li><a href="ProcessNewPartitionsAction.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.beam.sdk.io.gcp.bigtable.changestreams.action</div>
<h2 title="Class ProcessNewPartitionsAction" class="title">Class ProcessNewPartitionsAction</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>org.apache.beam.sdk.io.gcp.bigtable.changestreams.action.ProcessNewPartitionsAction</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">ProcessNewPartitionsAction</span>
extends java.lang.Object</pre>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../../../../../org/apache/beam/sdk/io/gcp/bigtable/changestreams/action/ProcessNewPartitionsAction.html#ProcessNewPartitionsAction-org.apache.beam.sdk.io.gcp.bigtable.changestreams.ChangeStreamMetrics-org.apache.beam.sdk.io.gcp.bigtable.changestreams.dao.MetadataTableDao-org.joda.time.Instant-">ProcessNewPartitionsAction</a></span>(<a href="../../../../../../../../../org/apache/beam/sdk/io/gcp/bigtable/changestreams/ChangeStreamMetrics.html" title="class in org.apache.beam.sdk.io.gcp.bigtable.changestreams">ChangeStreamMetrics</a>&nbsp;metrics,
                          <a href="../../../../../../../../../org/apache/beam/sdk/io/gcp/bigtable/changestreams/dao/MetadataTableDao.html" title="class in org.apache.beam.sdk.io.gcp.bigtable.changestreams.dao">MetadataTableDao</a>&nbsp;metadataTableDao,
                          <a href="https://static.javadoc.io/joda-time/joda-time/2.10.10/org/joda/time/Instant.html?is-external=true" title="class or interface in org.joda.time">Instant</a>&nbsp;endTime)</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../../../org/apache/beam/sdk/io/gcp/bigtable/changestreams/action/ProcessNewPartitionsAction.html#processNewPartition-org.apache.beam.sdk.io.gcp.bigtable.changestreams.model.NewPartition-org.apache.beam.sdk.transforms.DoFn.OutputReceiver-">processNewPartition</a></span>(<a href="../../../../../../../../../org/apache/beam/sdk/io/gcp/bigtable/changestreams/model/NewPartition.html" title="class in org.apache.beam.sdk.io.gcp.bigtable.changestreams.model">NewPartition</a>&nbsp;newPartition,
                   <a href="../../../../../../../../../org/apache/beam/sdk/transforms/DoFn.OutputReceiver.html" title="interface in org.apache.beam.sdk.transforms">DoFn.OutputReceiver</a>&lt;<a href="../../../../../../../../../org/apache/beam/sdk/io/gcp/bigtable/changestreams/model/PartitionRecord.html" title="class in org.apache.beam.sdk.io.gcp.bigtable.changestreams.model">PartitionRecord</a>&gt;&nbsp;receiver)</code>
<div class="block">Process a single new partition.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="ProcessNewPartitionsAction-org.apache.beam.sdk.io.gcp.bigtable.changestreams.ChangeStreamMetrics-org.apache.beam.sdk.io.gcp.bigtable.changestreams.dao.MetadataTableDao-org.joda.time.Instant-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>ProcessNewPartitionsAction</h4>
<pre>public&nbsp;ProcessNewPartitionsAction(<a href="../../../../../../../../../org/apache/beam/sdk/io/gcp/bigtable/changestreams/ChangeStreamMetrics.html" title="class in org.apache.beam.sdk.io.gcp.bigtable.changestreams">ChangeStreamMetrics</a>&nbsp;metrics,
                                  <a href="../../../../../../../../../org/apache/beam/sdk/io/gcp/bigtable/changestreams/dao/MetadataTableDao.html" title="class in org.apache.beam.sdk.io.gcp.bigtable.changestreams.dao">MetadataTableDao</a>&nbsp;metadataTableDao,
                                  <a href="https://static.javadoc.io/com.google.code.findbugs/jsr305/3.0.2/javax/annotation/Nullable.html?is-external=true" title="class or interface in javax.annotation">@Nullable</a>
                                  <a href="https://static.javadoc.io/joda-time/joda-time/2.10.10/org/joda/time/Instant.html?is-external=true" title="class or interface in org.joda.time">Instant</a>&nbsp;endTime)</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="processNewPartition-org.apache.beam.sdk.io.gcp.bigtable.changestreams.model.NewPartition-org.apache.beam.sdk.transforms.DoFn.OutputReceiver-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>processNewPartition</h4>
<pre>public&nbsp;boolean&nbsp;processNewPartition(<a href="../../../../../../../../../org/apache/beam/sdk/io/gcp/bigtable/changestreams/model/NewPartition.html" title="class in org.apache.beam.sdk.io.gcp.bigtable.changestreams.model">NewPartition</a>&nbsp;newPartition,
                                   <a href="../../../../../../../../../org/apache/beam/sdk/transforms/DoFn.OutputReceiver.html" title="interface in org.apache.beam.sdk.transforms">DoFn.OutputReceiver</a>&lt;<a href="../../../../../../../../../org/apache/beam/sdk/io/gcp/bigtable/changestreams/model/PartitionRecord.html" title="class in org.apache.beam.sdk.io.gcp.bigtable.changestreams.model">PartitionRecord</a>&gt;&nbsp;receiver)</pre>
<div class="block">Process a single new partition. New partition resulting from split and merges need to be
 outputted to be streamed. Regardless if it's a split or a merge, we have the same verification
 process in order to ensure the new partition can actually be streamed.

 <p>When a parent partition splits, it receives two or more new partitions. It will write a new
 row, with the new row ranges as row key, for each new partition. These new partitions can be
 immediately streamed.

 <p>The complicated scenario is merges. Two or more parent partitions will merge into one new
 partition. Each parent partition receives the same new partition (row range) but each parent
 partition will have a different continuation token. The parent partitions will all write to the
 same row key form by the new row range. Each parent will record its continuation token, and
 watermark. Parent partitions may not receive the message to stop at the same time. So when we
 try to process the new partition, we need to ensure that all the parent partitions have stopped
 and recorded their metadata table. We do so by verifying that the row ranges of the parents
 covers a contiguous block of row range that is same as the new row range.

 <p>For example, partition1, A-B, and partition2, B-C, merges into partition3, A-C.

 <ol>
   <li>p1 writes to row A-C in metadata table
   <li>processNewPartition process A-C seeing that only A-B has been recorded and A-B does not
       cover A-C. Do Nothing
   <li>p2 writes to row A-C in metadata table
   <li>processNewPartition process A-C again, seeing that A-B and B-C has been recorded and
       outputs new partition A-C to be streamed.
 </ol>

 <p>Note that, the algorithm to verify if a merge is valid, also correctly verifies if a split
 is valid. A split is immediately valid as long as the row exists because there's only one
 parent that needs to write to that row.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>newPartition</code> - new partition to be processed</dd>
<dd><code>receiver</code> - to output new partitions</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../../../../org/apache/beam/sdk/io/gcp/bigtable/changestreams/action/GenerateInitialPartitionsAction.html" title="class in org.apache.beam.sdk.io.gcp.bigtable.changestreams.action"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../../../../org/apache/beam/sdk/io/gcp/bigtable/changestreams/action/ReadChangeStreamPartitionAction.html" title="class in org.apache.beam.sdk.io.gcp.bigtable.changestreams.action"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../../../index.html?org/apache/beam/sdk/io/gcp/bigtable/changestreams/action/ProcessNewPartitionsAction.html" target="_top">Frames</a></li>
<li><a href="ProcessNewPartitionsAction.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>



<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>apache_beam.ml.inference.base module &mdash; Apache Beam 2.60.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/documentation_options.js?v=1bc0be70"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="apache_beam.ml.inference.huggingface_inference module" href="apache_beam.ml.inference.huggingface_inference.html" />
    <link rel="prev" title="apache_beam.ml.inference package" href="apache_beam.ml.inference.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Apache Beam
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="apache_beam.coders.html">apache_beam.coders package</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_beam.dataframe.html">apache_beam.dataframe package</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_beam.io.html">apache_beam.io package</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_beam.metrics.html">apache_beam.metrics package</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="apache_beam.ml.html">apache_beam.ml package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="apache_beam.ml.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="apache_beam.ml.gcp.html">apache_beam.ml.gcp package</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="apache_beam.ml.inference.html">apache_beam.ml.inference package</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="apache_beam.ml.inference.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="apache_beam.ml.transforms.html">apache_beam.ml.transforms package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="apache_beam.options.html">apache_beam.options package</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_beam.portability.html">apache_beam.portability package</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_beam.runners.html">apache_beam.runners package</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_beam.testing.html">apache_beam.testing package</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_beam.transforms.html">apache_beam.transforms package</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_beam.typehints.html">apache_beam.typehints package</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_beam.utils.html">apache_beam.utils package</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_beam.yaml.html">apache_beam.yaml package</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="apache_beam.error.html">apache_beam.error module</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_beam.pipeline.html">apache_beam.pipeline module</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_beam.pvalue.html">apache_beam.pvalue module</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Apache Beam</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="apache_beam.ml.html">apache_beam.ml package</a></li>
          <li class="breadcrumb-item"><a href="apache_beam.ml.inference.html">apache_beam.ml.inference package</a></li>
      <li class="breadcrumb-item active">apache_beam.ml.inference.base module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/apache_beam.ml.inference.base.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-apache_beam.ml.inference.base">
<span id="apache-beam-ml-inference-base-module"></span><h1>apache_beam.ml.inference.base module<a class="headerlink" href="#module-apache_beam.ml.inference.base" title="Link to this heading">¶</a></h1>
<p>An extensible run inference transform.</p>
<p>Users of this module can extend the ModelHandler class for any machine learning
framework. A ModelHandler implementation is a required parameter of
RunInference.</p>
<p>The transform handles standard inference functionality, like metric
collection, sharing model between threads, and batching elements.</p>
<dl class="py class">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.PredictionResult">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">apache_beam.ml.inference.base.</span></span><span class="sig-name descname"><span class="pre">PredictionResult</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">example</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inference</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#PredictionResult"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.PredictionResult" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#apache_beam.ml.inference.base.PredictionResult" title="apache_beam.ml.inference.base.PredictionResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">PredictionResult</span></code></a></p>
<p>A NamedTuple containing both input and output
from the inference.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelMetadata">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">apache_beam.ml.inference.base.</span></span><span class="sig-name descname"><span class="pre">ModelMetadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelMetadata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelMetadata" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NamedTuple" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NamedTuple</span></code></a></p>
<p>Create new instance of ModelMetadata(model_id, model_name)</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelMetadata.model_id">
<span class="sig-name descname"><span class="pre">model_id</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></em><a class="headerlink" href="#apache_beam.ml.inference.base.ModelMetadata.model_id" title="Link to this definition">¶</a></dt>
<dd><p>Unique identifier for the model. This can be
a file path or a URL where the model can be accessed. It is used to load
the model for inference.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelMetadata.model_name">
<span class="sig-name descname"><span class="pre">model_name</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></em><a class="headerlink" href="#apache_beam.ml.inference.base.ModelMetadata.model_name" title="Link to this definition">¶</a></dt>
<dd><p>Human-readable name for the model. This
can be used to identify the model in the metrics generated by the
RunInference transform.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.RunInferenceDLQ">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">apache_beam.ml.inference.base.</span></span><span class="sig-name descname"><span class="pre">RunInferenceDLQ</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">failed_inferences</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">failed_preprocessing</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">failed_postprocessing</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#RunInferenceDLQ"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.RunInferenceDLQ" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NamedTuple" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NamedTuple</span></code></a></p>
<p>Create new instance of RunInferenceDLQ(failed_inferences, failed_preprocessing, failed_postprocessing)</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.RunInferenceDLQ.failed_inferences">
<span class="sig-name descname"><span class="pre">failed_inferences</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference internal" href="apache_beam.pvalue.html#apache_beam.pvalue.PCollection" title="apache_beam.pvalue.PCollection"><span class="pre">PCollection</span></a></em><a class="headerlink" href="#apache_beam.ml.inference.base.RunInferenceDLQ.failed_inferences" title="Link to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.RunInferenceDLQ.failed_preprocessing">
<span class="sig-name descname"><span class="pre">failed_preprocessing</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sequence" title="(in Python v3.13)"><span class="pre">Sequence</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="apache_beam.pvalue.html#apache_beam.pvalue.PCollection" title="apache_beam.pvalue.PCollection"><span class="pre">PCollection</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#apache_beam.ml.inference.base.RunInferenceDLQ.failed_preprocessing" title="Link to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.RunInferenceDLQ.failed_postprocessing">
<span class="sig-name descname"><span class="pre">failed_postprocessing</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sequence" title="(in Python v3.13)"><span class="pre">Sequence</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="apache_beam.pvalue.html#apache_beam.pvalue.PCollection" title="apache_beam.pvalue.PCollection"><span class="pre">PCollection</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#apache_beam.ml.inference.base.RunInferenceDLQ.failed_postprocessing" title="Link to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyModelPathMapping">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">apache_beam.ml.inference.base.</span></span><span class="sig-name descname"><span class="pre">KeyModelPathMapping</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.13)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><span class="pre">KeyT</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#KeyModelPathMapping"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.KeyModelPathMapping" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Generic" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Generic</span></code></a>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">KeyT</span></code>]</p>
<p>Dataclass for mapping 1 or more keys to 1 model path. This is used in
conjunction with a KeyedModelHandler with many model handlers to update
a set of keys’ model handlers with the new path. Given
<cite>KeyModelPathMapping(keys: [‘key1’, ‘key2’], update_path: ‘updated/path’,
model_id: ‘id1’)</cite>, all examples with keys <cite>key1</cite> or <cite>key2</cite> will have their
corresponding model handler’s update_model function called with
‘updated/path’ and their metrics will correspond with ‘id1’. For more
information see the KeyedModelHandler documentation
<a class="reference external" href="https://beam.apache.org/releases/pydoc/current/apache_beam.ml.inference.base.html#apache_beam.ml.inference.base.KeyedModelHandler">https://beam.apache.org/releases/pydoc/current/apache_beam.ml.inference.base.html#apache_beam.ml.inference.base.KeyedModelHandler</a>
documentation and the website section on model updates
<a class="reference external" href="https://beam.apache.org/documentation/ml/about-ml/#automatic-model-refresh">https://beam.apache.org/documentation/ml/about-ml/#automatic-model-refresh</a></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyModelPathMapping.keys">
<span class="sig-name descname"><span class="pre">keys</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.13)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><span class="pre">KeyT</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#apache_beam.ml.inference.base.KeyModelPathMapping.keys" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyModelPathMapping.update_path">
<span class="sig-name descname"><span class="pre">update_path</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></em><a class="headerlink" href="#apache_beam.ml.inference.base.KeyModelPathMapping.update_path" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyModelPathMapping.model_id">
<span class="sig-name descname"><span class="pre">model_id</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">''</span></em><a class="headerlink" href="#apache_beam.ml.inference.base.KeyModelPathMapping.model_id" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">apache_beam.ml.inference.base.</span></span><span class="sig-name descname"><span class="pre">ModelHandler</span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Generic" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Generic</span></code></a>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">ExampleT</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">PredictionT</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">ModelT</span></code>]</p>
<p>Has the ability to load and apply an ML model.</p>
<p>Environment variables are set using a dict named ‘env_vars’ before
loading the model. Child classes can accept this dict as a kwarg.</p>
<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.load_model">
<span class="sig-name descname"><span class="pre">load_model</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ModelT</span></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.load_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.load_model" title="Link to this definition">¶</a></dt>
<dd><p>Loads and initializes a model for processing.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.run_inference">
<span class="sig-name descname"><span class="pre">run_inference</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sequence" title="(in Python v3.13)"><span class="pre">Sequence</span></a><span class="p"><span class="pre">[</span></span><span class="pre">ExampleT</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ModelT</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inference_args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.13)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.13)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><span class="pre">PredictionT</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.run_inference"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.run_inference" title="Link to this definition">¶</a></dt>
<dd><p>Runs inferences on a batch of examples.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>batch</strong> – A sequence of examples or features.</p></li>
<li><p><strong>model</strong> – The model used to make inferences.</p></li>
<li><p><strong>inference_args</strong> – Extra arguments for models whose inference call requires
extra parameters.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>An Iterable of Predictions.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.get_num_bytes">
<span class="sig-name descname"><span class="pre">get_num_bytes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sequence" title="(in Python v3.13)"><span class="pre">Sequence</span></a><span class="p"><span class="pre">[</span></span><span class="pre">ExampleT</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.get_num_bytes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.get_num_bytes" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The number of bytes of data for a batch.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.get_metrics_namespace">
<span class="sig-name descname"><span class="pre">get_metrics_namespace</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.get_metrics_namespace"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.get_metrics_namespace" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A namespace for metrics collected by the RunInference transform.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.get_resource_hints">
<span class="sig-name descname"><span class="pre">get_resource_hints</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><span class="pre">dict</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.get_resource_hints"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.get_resource_hints" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Resource hints for the transform.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.batch_elements_kwargs">
<span class="sig-name descname"><span class="pre">batch_elements_kwargs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Mapping" title="(in Python v3.13)"><span class="pre">Mapping</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.batch_elements_kwargs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.batch_elements_kwargs" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>kwargs suitable for beam.BatchElements.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.validate_inference_args">
<span class="sig-name descname"><span class="pre">validate_inference_args</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inference_args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.13)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.validate_inference_args"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.validate_inference_args" title="Link to this definition">¶</a></dt>
<dd><p>Validates inference_args passed in the inference call.</p>
<p>Because most frameworks do not need extra arguments in their predict() call,
the default behavior is to error out if inference_args are present.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.update_model_path">
<span class="sig-name descname"><span class="pre">update_model_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.update_model_path"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.update_model_path" title="Link to this definition">¶</a></dt>
<dd><p>Update the model path produced by side inputs. update_model_path should be
used when a ModelHandler represents a single model, not multiple models.
This will be true in most cases. For more information see the website
section on model updates
<a class="reference external" href="https://beam.apache.org/documentation/ml/about-ml/#automatic-model-refresh">https://beam.apache.org/documentation/ml/about-ml/#automatic-model-refresh</a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.update_model_paths">
<span class="sig-name descname"><span class="pre">update_model_paths</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ModelT</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_paths</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.13)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#apache_beam.ml.inference.base.KeyModelPathMapping" title="apache_beam.ml.inference.base.KeyModelPathMapping"><span class="pre">KeyModelPathMapping</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.update_model_paths"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.update_model_paths" title="Link to this definition">¶</a></dt>
<dd><p>Update the model paths produced by side inputs. update_model_paths should
be used when updating multiple models at once (e.g. when using a
KeyedModelHandler that holds multiple models).  For more information see
the KeyedModelHandler documentation
<a class="reference external" href="https://beam.apache.org/releases/pydoc/current/apache_beam.ml.inference.base.html#apache_beam.ml.inference.base.KeyedModelHandler">https://beam.apache.org/releases/pydoc/current/apache_beam.ml.inference.base.html#apache_beam.ml.inference.base.KeyedModelHandler</a>
documentation and the website section on model updates
<a class="reference external" href="https://beam.apache.org/documentation/ml/about-ml/#automatic-model-refresh">https://beam.apache.org/documentation/ml/about-ml/#automatic-model-refresh</a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.get_preprocess_fns">
<span class="sig-name descname"><span class="pre">get_preprocess_fns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.13)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.13)"><span class="pre">Callable</span></a><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.get_preprocess_fns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.get_preprocess_fns" title="Link to this definition">¶</a></dt>
<dd><p>Gets all preprocessing functions to be run before batching/inference.
Functions are in order that they should be applied.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.get_postprocess_fns">
<span class="sig-name descname"><span class="pre">get_postprocess_fns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.13)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.13)"><span class="pre">Callable</span></a><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.get_postprocess_fns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.get_postprocess_fns" title="Link to this definition">¶</a></dt>
<dd><p>Gets all postprocessing functions to be run after inference.
Functions are in order that they should be applied.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.should_skip_batching">
<span class="sig-name descname"><span class="pre">should_skip_batching</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><span class="pre">bool</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.should_skip_batching"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.should_skip_batching" title="Link to this definition">¶</a></dt>
<dd><p>Whether RunInference’s batching should be skipped. Can be flipped to
True by using <cite>with_no_batching</cite></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.set_environment_vars">
<span class="sig-name descname"><span class="pre">set_environment_vars</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.set_environment_vars"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.set_environment_vars" title="Link to this definition">¶</a></dt>
<dd><p>Sets environment variables using a dictionary provided via kwargs.
Keys are the env variable name, and values are the env variable value.
Child ModelHandler classes should set _env_vars via kwargs in __init__,
or else call super().__init__().</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.with_preprocess_fn">
<span class="sig-name descname"><span class="pre">with_preprocess_fn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.13)"><span class="pre">Callable</span></a><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">PreProcessT</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ExampleT</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#apache_beam.ml.inference.base.ModelHandler" title="apache_beam.ml.inference.base.ModelHandler"><span class="pre">ModelHandler</span></a><span class="p"><span class="pre">[</span></span><span class="pre">PreProcessT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">PredictionT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ModelT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">PreProcessT</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.with_preprocess_fn"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.with_preprocess_fn" title="Link to this definition">¶</a></dt>
<dd><p>Returns a new ModelHandler with a preprocessing function
associated with it. The preprocessing function will be run
before batching/inference and should map your input PCollection
to the base ModelHandler’s input type. If you apply multiple
preprocessing functions, they will be run on your original
PCollection in order from last applied to first applied.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.with_postprocess_fn">
<span class="sig-name descname"><span class="pre">with_postprocess_fn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.13)"><span class="pre">Callable</span></a><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">PredictionT</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">PostProcessT</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#apache_beam.ml.inference.base.ModelHandler" title="apache_beam.ml.inference.base.ModelHandler"><span class="pre">ModelHandler</span></a><span class="p"><span class="pre">[</span></span><span class="pre">ExampleT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">PostProcessT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ModelT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">PostProcessT</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.with_postprocess_fn"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.with_postprocess_fn" title="Link to this definition">¶</a></dt>
<dd><p>Returns a new ModelHandler with a postprocessing function
associated with it. The postprocessing function will be run
after inference and should map the base ModelHandler’s output
type to your desired output type. If you apply multiple
postprocessing functions, they will be run on your original
inference result in order from first applied to last applied.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.with_no_batching">
<span class="sig-name descname"><span class="pre">with_no_batching</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ModelHandler[Union[</span></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.with_no_batching"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.with_no_batching" title="Link to this definition">¶</a></dt>
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">ModelHandler.with_no_batching</span>&#160;&#160;&#160; <span class="pre">ExampleT,</span> <span class="pre">Iterable[ExampleT]],</span> <span class="pre">PostProcessT,</span> <span class="pre">ModelT,</span> <span class="pre">PostProcessT]</span></span></dt>
<dd><p>Returns a new ModelHandler which does not require batching
of inputs so that RunInference will skip this step.  RunInference will
expect the input to be pre-batched and passed in as an Iterable of records.
If you skip batching, any preprocessing functions should accept a batch of
data, not just a single record.</p>
<p>This option is only recommended if you want to do custom batching yourself.
If you just want to pass in records without a batching dimension, it is
recommended to (1) add <cite>max_batch_size=1</cite> to <cite>batch_elements_kwargs</cite> and
(2) remove the batching dimension as part of your inference call (by
calling <cite>record=batch[0]</cite>)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.share_model_across_processes">
<span class="sig-name descname"><span class="pre">share_model_across_processes</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><span class="pre">bool</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.share_model_across_processes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.share_model_across_processes" title="Link to this definition">¶</a></dt>
<dd><p>Returns a boolean representing whether or not a model should
be shared across multiple processes instead of being loaded per process.
This is primary useful for large models that  can’t fit multiple copies in
memory. Multi-process support may vary by runner, but this will fallback to
loading per process as necessary. See
<a class="reference external" href="https://beam.apache.org/releases/pydoc/current/apache_beam.utils.multi_process_shared.html">https://beam.apache.org/releases/pydoc/current/apache_beam.utils.multi_process_shared.html</a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.model_copies">
<span class="sig-name descname"><span class="pre">model_copies</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.model_copies"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.model_copies" title="Link to this definition">¶</a></dt>
<dd><p>Returns the maximum number of model copies that should be loaded at one
time. This only impacts model handlers that are using
share_model_across_processes to share their model across processes instead
of being loaded per process.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.override_metrics">
<span class="sig-name descname"><span class="pre">override_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metrics_namespace</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><span class="pre">bool</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.override_metrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.override_metrics" title="Link to this definition">¶</a></dt>
<dd><p>Returns a boolean representing whether or not a model handler will
override metrics reporting. If True, RunInference will not report any
metrics.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.ModelHandler.should_garbage_collect_on_timeout">
<span class="sig-name descname"><span class="pre">should_garbage_collect_on_timeout</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><span class="pre">bool</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#ModelHandler.should_garbage_collect_on_timeout"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.ModelHandler.should_garbage_collect_on_timeout" title="Link to this definition">¶</a></dt>
<dd><p>Whether the model should be garbage collected if model loading or
inference timeout, or if it should be left for future calls. Usually should
not be overriden unless the model handler implements other mechanisms for
garbage collection.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyModelMapping">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">apache_beam.ml.inference.base.</span></span><span class="sig-name descname"><span class="pre">KeyModelMapping</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.13)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><span class="pre">KeyT</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mh</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#apache_beam.ml.inference.base.ModelHandler" title="apache_beam.ml.inference.base.ModelHandler"><span class="pre">ModelHandler</span></a><span class="p"><span class="pre">[</span></span><span class="pre">ExampleT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">PredictionT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ModelT</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#KeyModelMapping"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.KeyModelMapping" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Generic" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Generic</span></code></a>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">KeyT</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">ExampleT</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">PredictionT</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">ModelT</span></code>]</p>
<p>Dataclass for mapping 1 or more keys to 1 model handler. Given
<cite>KeyModelMapping([‘key1’, ‘key2’], myMh)</cite>, all examples with keys <cite>key1</cite>
or <cite>key2</cite> will be run against the model defined by the <cite>myMh</cite> ModelHandler.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyedModelHandler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">apache_beam.ml.inference.base.</span></span><span class="sig-name descname"><span class="pre">KeyedModelHandler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">unkeyed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#apache_beam.ml.inference.base.ModelHandler" title="apache_beam.ml.inference.base.ModelHandler"><span class="pre">ModelHandler</span></a><span class="p"><span class="pre">[</span></span><span class="pre">ExampleT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">PredictionT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ModelT</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.13)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#apache_beam.ml.inference.base.KeyModelMapping" title="apache_beam.ml.inference.base.KeyModelMapping"><span class="pre">KeyModelMapping</span></a><span class="p"><span class="pre">[</span></span><span class="pre">KeyT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ExampleT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">PredictionT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ModelT</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_models_per_worker_hint</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#KeyedModelHandler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.KeyedModelHandler" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Generic" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Generic</span></code></a>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">KeyT</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">ExampleT</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">PredictionT</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">ModelT</span></code>], <a class="reference internal" href="#apache_beam.ml.inference.base.ModelHandler" title="apache_beam.ml.inference.base.ModelHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelHandler</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">KeyT</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">ExampleT</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">KeyT</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">PredictionT</span></code>], <code class="xref py py-obj docutils literal notranslate"><span class="pre">ModelT</span></code> | <code class="xref py py-class docutils literal notranslate"><span class="pre">_ModelManager</span></code>]</p>
<p>A ModelHandler that takes keyed examples and returns keyed predictions.</p>
<p>For example, if the original model is used with RunInference to take a
PCollection[E] to a PCollection[P], this ModelHandler would take a
PCollection[Tuple[K, E]] to a PCollection[Tuple[K, P]], making it possible
to use the key to associate the outputs with the inputs. KeyedModelHandler
is able to accept either a single unkeyed ModelHandler or many different
model handlers corresponding to the keys for which that ModelHandler should
be used. For example, the following configuration could be used to map keys
1-3 to ModelHandler1 and keys 4-5 to ModelHandler2:</p>
<blockquote>
<div><p>k1 = [‘k1’, ‘k2’, ‘k3’]
k2 = [‘k4’, ‘k5’]
KeyedModelHandler([KeyModelMapping(k1, mh1), KeyModelMapping(k2, mh2)])</p>
</div></blockquote>
<p>Note that a single copy of each of these models may all be held in memory
at the same time; be careful not to load too many large models or your
pipeline may cause Out of Memory exceptions.</p>
<p>KeyedModelHandlers support Automatic Model Refresh to update your model
to a newer version without stopping your streaming pipeline. For an
overview of this feature, see
<a class="reference external" href="https://beam.apache.org/documentation/ml/about-ml/#automatic-model-refresh">https://beam.apache.org/documentation/ml/about-ml/#automatic-model-refresh</a></p>
<p>To use this feature with a KeyedModelHandler that has many models per key,
you can pass in a list of KeyModelPathMapping objects to define your new
model paths. For example, passing in the side input of</p>
<blockquote>
<div><p>[KeyModelPathMapping(keys=[‘k1’, ‘k2’], update_path=’update/path/1’),
KeyModelPathMapping(keys=[‘k3’], update_path=’update/path/2’)]</p>
</div></blockquote>
<p>will update the model corresponding to keys ‘k1’ and ‘k2’ with path
‘update/path/1’ and the model corresponding to ‘k3’ with ‘update/path/2’.
In order to do a side input update: (1) all restrictions mentioned in
<a class="reference external" href="https://beam.apache.org/documentation/ml/about-ml/#automatic-model-refresh">https://beam.apache.org/documentation/ml/about-ml/#automatic-model-refresh</a>
must be met, (2) all update_paths must be non-empty, even if they are not
being updated from their original values, and (3) the set of keys
originally defined cannot change. This means that if originally you have
defined model handlers for ‘key1’, ‘key2’, and ‘key3’, all 3 of those keys
must appear in your list of KeyModelPathMappings exactly once. No
additional keys can be added.</p>
<p>When using many models defined per key, metrics about inference and model
loading will be gathered on an  aggregate basis for all keys. These will be
reported with no prefix. Metrics will also be gathered on a per key basis.
Since some keys can share the same model, only one set of metrics will be
reported per key ‘cohort’. These will be reported in the form:
<cite>&lt;cohort_key&gt;-&lt;metric_name&gt;</cite>, where <cite>&lt;cohort_key&gt;</cite> can be any key selected
from the cohort. When model updates occur, the metrics will be reported in
the form <cite>&lt;cohort_key&gt;-&lt;model id&gt;-&lt;metric_name&gt;</cite>.</p>
<p>Loading multiple models at the same time can increase the risk of an out of
memory (OOM) exception. To avoid this issue, use the parameter
<cite>max_models_per_worker_hint</cite> to limit the number of models that are loaded
at the same time. For more information about memory management, see
<cite>Use a keyed `ModelHandler &lt;https://beam.apache.org/documentation/ml/about-ml/#use-a-keyed-modelhandler-object&gt;_</cite>.  # pylint: disable=line-too-long</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>unkeyed</strong> – Either (a) an implementation of ModelHandler that does not
require keys or (b) a list of KeyModelMappings mapping lists of keys to
unkeyed ModelHandlers.</p></li>
<li><p><strong>max_models_per_worker_hint</strong> – A hint to the runner indicating how many
models can be held in memory at one time per worker process. For
example, if your worker has 8 GB of memory provisioned and your workers
take up 1 GB each, you should set this to 7 to allow all models to sit
in memory with some buffer. For more information about memory management,
see <cite>Use a keyed `ModelHandler &lt;https://beam.apache.org/documentation/ml/about-ml/#use-a-keyed-modelhandler-object&gt;_</cite>.  # pylint: disable=line-too-long</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyedModelHandler.load_model">
<span class="sig-name descname"><span class="pre">load_model</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ModelT</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_ModelManager</span></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#KeyedModelHandler.load_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.KeyedModelHandler.load_model" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyedModelHandler.run_inference">
<span class="sig-name descname"><span class="pre">run_inference</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sequence" title="(in Python v3.13)"><span class="pre">Sequence</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><span class="pre">KeyT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ExampleT</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ModelT</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_ModelManager</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inference_args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.13)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.13)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><span class="pre">KeyT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">PredictionT</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#KeyedModelHandler.run_inference"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.KeyedModelHandler.run_inference" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyedModelHandler.get_num_bytes">
<span class="sig-name descname"><span class="pre">get_num_bytes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sequence" title="(in Python v3.13)"><span class="pre">Sequence</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><span class="pre">KeyT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ExampleT</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#KeyedModelHandler.get_num_bytes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.KeyedModelHandler.get_num_bytes" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyedModelHandler.get_metrics_namespace">
<span class="sig-name descname"><span class="pre">get_metrics_namespace</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#KeyedModelHandler.get_metrics_namespace"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.KeyedModelHandler.get_metrics_namespace" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyedModelHandler.get_resource_hints">
<span class="sig-name descname"><span class="pre">get_resource_hints</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#KeyedModelHandler.get_resource_hints"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.KeyedModelHandler.get_resource_hints" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyedModelHandler.batch_elements_kwargs">
<span class="sig-name descname"><span class="pre">batch_elements_kwargs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#KeyedModelHandler.batch_elements_kwargs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.KeyedModelHandler.batch_elements_kwargs" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyedModelHandler.validate_inference_args">
<span class="sig-name descname"><span class="pre">validate_inference_args</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inference_args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.13)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#KeyedModelHandler.validate_inference_args"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.KeyedModelHandler.validate_inference_args" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyedModelHandler.update_model_paths">
<span class="sig-name descname"><span class="pre">update_model_paths</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ModelT</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">_ModelManager</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_paths</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.13)"><span class="pre">List</span></a><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#apache_beam.ml.inference.base.KeyModelPathMapping" title="apache_beam.ml.inference.base.KeyModelPathMapping"><span class="pre">KeyModelPathMapping</span></a><span class="p"><span class="pre">[</span></span><span class="pre">KeyT</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#KeyedModelHandler.update_model_paths"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.KeyedModelHandler.update_model_paths" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyedModelHandler.update_model_path">
<span class="sig-name descname"><span class="pre">update_model_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#KeyedModelHandler.update_model_path"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.KeyedModelHandler.update_model_path" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyedModelHandler.share_model_across_processes">
<span class="sig-name descname"><span class="pre">share_model_across_processes</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><span class="pre">bool</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#KeyedModelHandler.share_model_across_processes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.KeyedModelHandler.share_model_across_processes" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyedModelHandler.model_copies">
<span class="sig-name descname"><span class="pre">model_copies</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#KeyedModelHandler.model_copies"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.KeyedModelHandler.model_copies" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyedModelHandler.override_metrics">
<span class="sig-name descname"><span class="pre">override_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metrics_namespace</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><span class="pre">bool</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#KeyedModelHandler.override_metrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.KeyedModelHandler.override_metrics" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.KeyedModelHandler.should_garbage_collect_on_timeout">
<span class="sig-name descname"><span class="pre">should_garbage_collect_on_timeout</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><span class="pre">bool</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#KeyedModelHandler.should_garbage_collect_on_timeout"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.KeyedModelHandler.should_garbage_collect_on_timeout" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.MaybeKeyedModelHandler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">apache_beam.ml.inference.base.</span></span><span class="sig-name descname"><span class="pre">MaybeKeyedModelHandler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">unkeyed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#apache_beam.ml.inference.base.ModelHandler" title="apache_beam.ml.inference.base.ModelHandler"><span class="pre">ModelHandler</span></a><span class="p"><span class="pre">[</span></span><span class="pre">ExampleT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">PredictionT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ModelT</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#MaybeKeyedModelHandler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.MaybeKeyedModelHandler" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Generic" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Generic</span></code></a>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">KeyT</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">ExampleT</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">PredictionT</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">ModelT</span></code>], <a class="reference internal" href="#apache_beam.ml.inference.base.ModelHandler" title="apache_beam.ml.inference.base.ModelHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelHandler</span></code></a>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">ExampleT</span></code> | <code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">KeyT</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">ExampleT</span></code>], <code class="xref py py-obj docutils literal notranslate"><span class="pre">PredictionT</span></code> | <code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">KeyT</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">PredictionT</span></code>], <code class="xref py py-obj docutils literal notranslate"><span class="pre">ModelT</span></code>]</p>
<p>A ModelHandler that takes examples that might have keys and returns
predictions that might have keys.</p>
<p>For example, if the original model is used with RunInference to take a
PCollection[E] to a PCollection[P], this ModelHandler would take either
PCollection[E] to a PCollection[P] or PCollection[Tuple[K, E]] to a
PCollection[Tuple[K, P]], depending on the whether the elements are
tuples. This pattern makes it possible to associate the outputs with the
inputs based on the key.</p>
<p>Note that you cannot use this ModelHandler if E is a tuple type.
In addition, either all examples should be keyed, or none of them.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>unkeyed</strong> – An implementation of ModelHandler that does not require keys.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.MaybeKeyedModelHandler.load_model">
<span class="sig-name descname"><span class="pre">load_model</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ModelT</span></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#MaybeKeyedModelHandler.load_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.MaybeKeyedModelHandler.load_model" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.MaybeKeyedModelHandler.run_inference">
<span class="sig-name descname"><span class="pre">run_inference</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sequence" title="(in Python v3.13)"><span class="pre">Sequence</span></a><span class="p"><span class="pre">[</span></span><span class="pre">ExampleT</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><span class="pre">KeyT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ExampleT</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ModelT</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inference_args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.13)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.13)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><span class="pre">PredictionT</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.13)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><span class="pre">KeyT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">PredictionT</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#MaybeKeyedModelHandler.run_inference"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.MaybeKeyedModelHandler.run_inference" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.MaybeKeyedModelHandler.get_num_bytes">
<span class="sig-name descname"><span class="pre">get_num_bytes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sequence" title="(in Python v3.13)"><span class="pre">Sequence</span></a><span class="p"><span class="pre">[</span></span><span class="pre">ExampleT</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><span class="pre">KeyT</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ExampleT</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#MaybeKeyedModelHandler.get_num_bytes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.MaybeKeyedModelHandler.get_num_bytes" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.MaybeKeyedModelHandler.get_metrics_namespace">
<span class="sig-name descname"><span class="pre">get_metrics_namespace</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#MaybeKeyedModelHandler.get_metrics_namespace"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.MaybeKeyedModelHandler.get_metrics_namespace" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.MaybeKeyedModelHandler.get_resource_hints">
<span class="sig-name descname"><span class="pre">get_resource_hints</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#MaybeKeyedModelHandler.get_resource_hints"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.MaybeKeyedModelHandler.get_resource_hints" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.MaybeKeyedModelHandler.batch_elements_kwargs">
<span class="sig-name descname"><span class="pre">batch_elements_kwargs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#MaybeKeyedModelHandler.batch_elements_kwargs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.MaybeKeyedModelHandler.batch_elements_kwargs" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.MaybeKeyedModelHandler.validate_inference_args">
<span class="sig-name descname"><span class="pre">validate_inference_args</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inference_args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.13)"><span class="pre">Dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#MaybeKeyedModelHandler.validate_inference_args"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.MaybeKeyedModelHandler.validate_inference_args" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.MaybeKeyedModelHandler.update_model_path">
<span class="sig-name descname"><span class="pre">update_model_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#MaybeKeyedModelHandler.update_model_path"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.MaybeKeyedModelHandler.update_model_path" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.MaybeKeyedModelHandler.get_preprocess_fns">
<span class="sig-name descname"><span class="pre">get_preprocess_fns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.13)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.13)"><span class="pre">Callable</span></a><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#MaybeKeyedModelHandler.get_preprocess_fns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.MaybeKeyedModelHandler.get_preprocess_fns" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.MaybeKeyedModelHandler.get_postprocess_fns">
<span class="sig-name descname"><span class="pre">get_postprocess_fns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.13)"><span class="pre">Iterable</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.13)"><span class="pre">Callable</span></a><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.13)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#MaybeKeyedModelHandler.get_postprocess_fns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.MaybeKeyedModelHandler.get_postprocess_fns" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.MaybeKeyedModelHandler.should_skip_batching">
<span class="sig-name descname"><span class="pre">should_skip_batching</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><span class="pre">bool</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#MaybeKeyedModelHandler.should_skip_batching"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.MaybeKeyedModelHandler.should_skip_batching" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.MaybeKeyedModelHandler.share_model_across_processes">
<span class="sig-name descname"><span class="pre">share_model_across_processes</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><span class="pre">bool</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#MaybeKeyedModelHandler.share_model_across_processes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.MaybeKeyedModelHandler.share_model_across_processes" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.MaybeKeyedModelHandler.model_copies">
<span class="sig-name descname"><span class="pre">model_copies</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#MaybeKeyedModelHandler.model_copies"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.MaybeKeyedModelHandler.model_copies" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.RunInference">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">apache_beam.ml.inference.base.</span></span><span class="sig-name descname"><span class="pre">RunInference</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">model_handler:</span> <span class="pre">~apache_beam.ml.inference.base.ModelHandler[~apache_beam.ml.inference.base.ExampleT,</span> <span class="pre">~apache_beam.ml.inference.base.PredictionT,</span> <span class="pre">~typing.Any],</span> <span class="pre">clock=&lt;module</span> <span class="pre">'time'</span> <span class="pre">(built-in)&gt;,</span> <span class="pre">inference_args:</span> <span class="pre">~typing.Dict[str,</span> <span class="pre">~typing.Any]</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">metrics_namespace:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">*,</span> <span class="pre">model_metadata_pcoll:</span> <span class="pre">~apache_beam.pvalue.PCollection[~apache_beam.ml.inference.base.ModelMetadata]</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">watch_model_pattern:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">model_identifier:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">**kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#RunInference"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.RunInference" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="apache_beam.transforms.ptransform.html#apache_beam.transforms.ptransform.PTransform" title="apache_beam.transforms.ptransform.PTransform"><code class="xref py py-class docutils literal notranslate"><span class="pre">PTransform</span></code></a>[<a class="reference internal" href="apache_beam.pvalue.html#apache_beam.pvalue.PCollection" title="apache_beam.pvalue.PCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PCollection</span></code></a>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">ExampleT</span></code> | <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code></a>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">ExampleT</span></code>]], <a class="reference internal" href="apache_beam.pvalue.html#apache_beam.pvalue.PCollection" title="apache_beam.pvalue.PCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">PCollection</span></code></a>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">PredictionT</span></code>]]</p>
<p>A transform that takes a PCollection of examples (or features) for use
on an ML model. The transform then outputs inferences (or predictions) for
those examples in a PCollection of PredictionResults that contains the input
examples and the output inferences.</p>
<p>Models for supported frameworks can be loaded using a URI. Supported
services can also be used.</p>
<p>This transform attempts to batch examples using the beam.BatchElements
transform. Batching can be configured using the ModelHandler.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_handler</strong> – An implementation of ModelHandler.</p></li>
<li><p><strong>clock</strong> – A clock implementing time_ns. <em>Used for unit testing.</em></p></li>
<li><p><strong>inference_args</strong> – Extra arguments for models whose inference call requires
extra parameters.</p></li>
<li><p><strong>metrics_namespace</strong> – Namespace of the transform to collect metrics.</p></li>
<li><p><strong>model_metadata_pcoll</strong> – PCollection that emits Singleton ModelMetadata
containing model path and model name, that is used as a side input
to the _RunInferenceDoFn.</p></li>
<li><p><strong>watch_model_pattern</strong> – A glob pattern used to watch a directory
for automatic model refresh.</p></li>
<li><p><strong>model_identifier</strong> – A string used to identify the model being loaded. You
can set this if you want to reuse the same model across multiple
RunInference steps and don’t want to reload it twice. Note that using
the same tag for different models will lead to non-deterministic
results, so exercise caution when using this parameter. This only
impacts models which are already being shared across processes.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.RunInference.annotations">
<span class="sig-name descname"><span class="pre">annotations</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#RunInference.annotations"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.RunInference.annotations" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.RunInference.from_callable">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_callable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_handler_provider</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#RunInference.from_callable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.RunInference.from_callable" title="Link to this definition">¶</a></dt>
<dd><p>Multi-language friendly constructor.</p>
<p>Use this constructor with fully_qualified_named_transform to
initialize the RunInference transform from PythonCallableSource provided
by foreign SDKs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_handler_provider</strong> – A callable object that returns ModelHandler.</p></li>
<li><p><strong>kwargs</strong> – Keyword arguments for model_handler_provider.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.RunInference.expand">
<span class="sig-name descname"><span class="pre">expand</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pcoll</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="apache_beam.pvalue.html#apache_beam.pvalue.PCollection" title="apache_beam.pvalue.PCollection"><span class="pre">PCollection</span></a><span class="p"><span class="pre">[</span></span><span class="pre">ExampleT</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="apache_beam.pvalue.html#apache_beam.pvalue.PCollection" title="apache_beam.pvalue.PCollection"><span class="pre">PCollection</span></a><span class="p"><span class="pre">[</span></span><span class="pre">PredictionT</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#RunInference.expand"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.RunInference.expand" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.RunInference.with_exception_handling">
<span class="sig-name descname"><span class="pre">with_exception_handling</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exc_class=&lt;class</span> <span class="pre">'Exception'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_subprocess=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold=1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout:</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#RunInference.with_exception_handling"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.RunInference.with_exception_handling" title="Link to this definition">¶</a></dt>
<dd><p>Automatically provides a dead letter output for skipping bad records.
This can allow a pipeline to continue successfully rather than fail or
continuously throw errors on retry when bad elements are encountered.</p>
<p>This returns a tagged output with two PCollections, the first being the
results of successfully processing the input PCollection, and the second
being the set of bad batches of records (those which threw exceptions
during processing) along with information about the errors raised.</p>
<p>For example, one would write:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">main</span><span class="p">,</span> <span class="n">other</span> <span class="o">=</span> <span class="n">RunInference</span><span class="p">(</span>
  <span class="n">maybe_error_raising_model_handler</span>
<span class="p">)</span><span class="o">.</span><span class="n">with_exception_handling</span><span class="p">()</span>
</pre></div>
</div>
<p>and <cite>main</cite> will be a PCollection of PredictionResults and <cite>other</cite> will
contain a <cite>RunInferenceDLQ</cite> object with PCollections containing failed
records for each failed inference, preprocess operation, or postprocess
operation. To access each collection of failed records, one would write:</p>
<blockquote>
<div><p>failed_inferences = other.failed_inferences
failed_preprocessing = other.failed_preprocessing
failed_postprocessing = other.failed_postprocessing</p>
</div></blockquote>
<p>failed_inferences is in the form
PCollection[Tuple[failed batch, exception]].</p>
<p>failed_preprocessing is in the form
list[PCollection[Tuple[failed record, exception]]]], where each element of
the list corresponds to a preprocess function. These PCollections are
in the same order that the preprocess functions are applied.</p>
<p>failed_postprocessing is in the form
List[PCollection[Tuple[failed record, exception]]]], where each element of
the list corresponds to a postprocess function. These PCollections are
in the same order that the postprocess functions are applied.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>exc_class</strong> – An exception class, or tuple of exception classes, to catch.
Optional, defaults to ‘Exception’.</p></li>
<li><p><strong>use_subprocess</strong> – Whether to execute the DoFn logic in a subprocess. This
allows one to recover from errors that can crash the calling process
(e.g. from an underlying library causing a segfault), but is
slower as elements and results must cross a process boundary.  Note
that this starts up a long-running process that is used to handle
all the elements (until hard failure, which should be rare) rather
than a new process per element, so the overhead should be minimal
(and can be amortized if there’s any per-process or per-bundle
initialization that needs to be done). Optional, defaults to False.</p></li>
<li><p><strong>threshold</strong> – An upper bound on the ratio of records that can be bad before
aborting the entire pipeline. Optional, defaults to 1.0 (meaning
up to 100% of records can be bad and the pipeline will still succeed).</p></li>
<li><p><strong>timeout</strong> – The maximum amount of time in seconds given to load a model, run
inference on a batch of elements and perform and pre/postprocessing
operations. Since the timeout applies in multiple places, it should
be equal to the maximum possible timeout for any of these operations.
Note in particular that model load and inference on a single batch
count to the same timeout value. When an inference fails, all related
resources, including the model, will be deleted and reloaded. As a
result, it is recommended to leave significant buffer and set the
timeout to at least <cite>2 * (time to load model + time to run
inference on a batch of data)</cite>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="apache_beam.ml.inference.base.load_model_status">
<span class="sig-prename descclassname"><span class="pre">apache_beam.ml.inference.base.</span></span><span class="sig-name descname"><span class="pre">load_model_status</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_tag</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">share_across_processes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><span class="pre">bool</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">_ModelStatus</span></span></span><a class="reference internal" href="_modules/apache_beam/ml/inference/base.html#load_model_status"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#apache_beam.ml.inference.base.load_model_status" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="apache_beam.ml.inference.html" class="btn btn-neutral float-left" title="apache_beam.ml.inference package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="apache_beam.ml.inference.huggingface_inference.html" class="btn btn-neutral float-right" title="apache_beam.ml.inference.huggingface_inference module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>